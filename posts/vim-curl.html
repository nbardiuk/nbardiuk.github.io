<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> Vim as HTTP client @  Nazarii's blog</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/default.css" />
    <meta name="google-site-verification" content="1eqgeS8dNQrx_2L4hO1e5FzIq3AbotzOVmASihAsJVA"/>
    <link href="https://webmention.io/nazarii.bardiuk.com/xmlrpc" rel="pingback"/>
    <link href="https://webmention.io/nazarii.bardiuk.com/webmention" rel="webmention"/>
</head>
<body><header>
    <div class="logo">
        <a href="/">Nazarii's blog</a>
    </div>
</header>
<main role="main">
<article class="h-entry">
    <link class="u-url" href="https://nazarii.bardiuk.com/posts/vim-curl.html">
    <link rel="author" class="p-author h-card" href="/"/>
    <section class="header">
        <h1 class="p-name">Vim as HTTP client</h1>
        Posted on 
        <time class="dt-published" datetime="2020-10-05T00:00:00Z">
            October 5, 2020
        </time>
    </section>
    <section class="e-content" >
        <p>Let me share a quick tip on how to use Vim with curl as a simple HTTP client.</p>
<video width="95%" autoplay loop>
  <source src="/videos/curl.webm" type="video/webm"/>
</video>
<p>In the core of this tip is a filter through curl.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-vim" data-lang="vim">:!curl --config -<span style="">
</span></code></pre></div><p>Let us walk through this.</p>
<h2 id="vim-filter">Vim filter</h2>
<p><a href="https://vimhelp.org/change.txt.html#filter"><code>:help filter</code></a></p>
<blockquote>
<p>A filter is a program that accepts text at standard input, changes it in some way, and sends it to standard output.</p>
</blockquote>
<p>We can send some buffer lines to an external command, and Vim will replace them with the command output.</p>
<p>Given a buffer</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">3
2
4
1
</code></pre></div><p>After filtering lines through the sort command</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-vim" data-lang="vim">:%!sort<span style="">
</span></code></pre></div><p>The lines are in order.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">1
2
3
4
</code></pre></div><h2 id="curl-configuration-file">curl configuration file</h2>
<p>Curl allows passing all command-line flags using a configuration file.</p>
<p><a href="https://curl.haxx.se/docs/manpage.html#-K"><code>--config</code></a></p>
<blockquote>
<p>Specify a text file to read curl arguments from. The command line arguments found in the text file will be used as if they were provided on the command line.</p>
</blockquote>
<p>Like many command-line apps, curl uses a hyphen (<code>-</code>) to make the app read file from standard input.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-sh" data-lang="sh">$ echo <span style="font-style:italic">&#39;--url http://ifconfig.me --silent&#39;</span> | curl --config -
1.2.3.4
</code></pre></div><p>Let&rsquo;s use this in Vim buffer.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">--url http://ifconfig.me
--silent
--show-error
</code></pre></div><p>run the command</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-vim" data-lang="vim">:%!curl --config -<span style="">
</span></code></pre></div><p>The buffer now contains a curl response.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">1.2.3.4
</code></pre></div><h2 id="interactive-approach">Interactive approach</h2>
<p>It&rsquo;s hard to iterate over request arguments because the curl command replaces them with the response.</p>
<p>To make it more interactive, we can duplicate the configuration lines before running the curl.</p>
<p>Below is a sequence of commands that can help with this</p>
<ul>
<li><code>vip</code> select all configuration lines using paragraph text object</li>
<li><code>y</code> copy selected lines</li>
<li><code>P</code> paste before the cursor</li>
<li><code>gv</code> reselect the lines</li>
<li><code>:!curl --config -</code> run curl on the selection</li>
</ul>
<p>Record this into a macro or create a command, and you have an interactive environment.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-vimrc" data-lang="vimrc">:map &lt;leader&gt;cc vipyPgvO&lt;Esc&gt;O&lt;Esc&gt;gv:!curl --config -&lt;CR&gt;<span style="">
</span></code></pre></div><p>The extra bit <code>gvO&lt;Esc&gt;O&lt;Esc&gt;</code> inserts an empty line between request and response. It helps to make them different paragraphs, distinct text objects.</p>
<h2 id="use-a-plugin">Use a plugin</h2>
<p>This approach is excellent for a quick hack or an example of using the Vim filter command.</p>
<p>I don&rsquo;t use it every day. Instead, I prefer to use a plugin like <a href="https://github.com/diepm/vim-rest-console">Vim REST Console</a>.
Compared to the simple curl command, it has several advantages:</p>
<ul>
<li>has simple HTTP syntax</li>
<li>supports variables</li>
<li>does not require escaping POST payload</li>
<li>formats response payload</li>
</ul>

    </section>
</article>

        </main><footer class="h-card">
    © 2014–2020
    <span class="p-name">Nazarii Bardiuk</span>
    <link class="u-url" href="https://nazarii.bardiu.com" rel="me"/>
    <link class="u-email" href="mailto:nazarii@bardiuk.com" rel="me"/>
    <link href="https://github.com/nbardiuk" rel="me"/>
    <link href="https://twitter.com/nbardiuk" rel="me"/>
    <link href="https://mastodon.social/@Nbardiuk" rel="me"/>
</footer>
</body>
</html>
